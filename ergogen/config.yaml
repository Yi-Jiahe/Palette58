units:
  # Proxy Spacing Variables
  kx: u
  ky: u
  border_padding: 2

points:
  zones:
    matrix:
      columns:
        outer:
          key:
            column_net: col_1
        pinky:
          key:
            stagger: 5
            column_net: col_2
        ring:
          key:
            stagger: 15
            column_net: col_3
        middle:
          key:
            stagger: 3.5
            column_net: col_4
        index:
          key:
            stagger: -6
            column_net: col_5
        inner:
          key:
            stagger: -4
            column_net: col_6
      rows:
        bottom:
          # Note: row_net is not in key for whatever reason
          row_net: row_4
        home:
          row_net: row_3
        top:
          row_net: row_2
        num:
          row_net: row_1
    thumb:
      anchor:
        ref: matrix_ring_bottom
        shift: [3, -(ky+2)]
      columns:
        outer-3:
          key:
            splay: -5
            column_net: col_2
        outer-2:
          key:
            splay: -5
            shift: [1.3, -0.8]
            column_net: col_3
        outer:
          key:
            splay: -5
            shift: [2.6, -1.6]
            column_net: col_4
        home:
          key:
            splay: -5
            shift: [3.9, -2.4]
            height: 1.5kx
            column_net: col_5
        inner:
          key: 
            splay: -5
            shift: [5.2, -3]
            height: 2.25kx
            column_net: col_6
      rows:
        cluster:
          row_net: row_5

outlines:
  keys:
    - what: rectangle
      where: true
      bound: false
      size: [14,14]
  board:
    - what: polygon
      operation: stack
      points:
      - ref: matrix_outer_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_pinky_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_ring_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_middle_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_middle_num
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: matrix_index_num
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: matrix_inner_num
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: matrix_inner_num
        shift: [30, ky/2+border_padding]
      - ref: matrix_inner_num
        shift: [30, -80]
      - ref: thumb_inner_cluster
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: thumb_inner_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_home_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer-2_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer-3_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer-3_cluster
        shift: [-(kx/2+border_padding), -(ky/2+border_padding)]
      - ref: matrix_outer_bottom
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: matrix_outer_bottom
        shift: [-(kx/2+border_padding), -(ky/2+border_padding)]
      fillet: 5
  combo:
    - name: board
    - operation: subtract
      name: keys
    
pcbs:
  pcb:
    outlines:
      main:
        outline: board
    footprints:
      nice!nano:
        what: nice!nano_v2
        params:
          orientation: "down"
          P031: "col_1"
          P029: "col_2"
          P002: "col_3"
          P115: "col_4"
          P113: "col_5"
          P111: "col_6"
          P017: "row_1"
          P020: "row_2"
          P022: "row_3"
          P024: "row_4"
          P100: "row_5"
          P104: "SCL"
          P106: "SDA"
          BPLUS: "B+"
          BMINUS: "GND"
        where:
          ref: matrix_inner_num
          shift: [20, -9]
          rotate: -90
      oled:
        what: oled
        adjust:
          ref: matrix_inner_num
          shift: [26, -25]
          rotate: -90
        params:
          SDA: "SDA"
          SCL: "SCL"
      jstph:
        what: jstph
        adjust:
          ref: matrix_inner_num
          shift: [12.5, -32]
          rotate: 90
        params:
          pos: "JST+"
          neg: "GND"
      power_switch:
        what: toggle_switch
        adjust:
          ref: matrix_inner_num
          shift: [28.5, -32]
          rotate: -90
        params:
          from: ""
          right: "JST+"
          left: "B+"
      charging_diode:
        what: combo_diode
        adjust:
          ref: matrix_inner_num
          shift: [23, -32]
          rotate: 90
        params:
          SMD: true
          from: "B+"
          to: "JST+"
      gateron_low_profile_hotswap:
        # Need the right footprints
        # mx has too small stem hole for the low profile switches
        # The hotswap socket is different too I believe
        what: gateron_low_profile
        where: true
        params:
          keycaps: true
          reverse: false
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
      diodes:
        what: combo_diode
        where: true
        adjust:
          shift: [8.25, 0]
          rotate: -90
        params:
          SMD: true
          from: "{{colrow}}"
          to: "{{row_net}}"
      rgb:
        what: WS2812B-2020
        where: true
        adjust:
          shift: [0,5.75]
        params:
          din: ""
          dout: ""
      hotswap_diode_vias:
        what: covered_via
        where: true
        adjust:
          shift: [6.40, -5.75]
        params:
          net: "{{colrow}}"
      led_ground_vias:
        what: covered_via
        where: true
        adjust:
          shift: [-0.915, 5.20]
        params:
          net: "GND"
