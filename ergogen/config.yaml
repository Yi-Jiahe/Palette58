units:
  # Proxy Spacing Variables
  kx: u
  ky: u
  border_padding: 2

points:
  zones:
    matrix:
      columns:
        outer:
          key:
            column_net: col_1
        pinky:
          key:
            stagger: 5
            column_net: col_2
        ring:
          key:
            stagger: 15
            column_net: col_3
        middle:
          key:
            stagger: 3.5
            column_net: col_4
        index:
          key:
            stagger: -6
            column_net: col_5
        inner:
          key:
            stagger: -4
            column_net: col_6
      rows:
        bottom:
          # Note: row_net is not in key for whatever reason
          row_net: row_4
        home:
          row_net: row_3
        top:
          row_net: row_2
        num:
          row_net: row_1
    thumb:
      anchor:
        ref: matrix_ring_bottom
        shift: [3, -(ky+2)]
      columns:
        outer-3:
          key:
            splay: -5
            column_net: col_2
        outer-2:
          key:
            splay: -5
            shift: [1.3, -0.8]
            column_net: col_3
        outer:
          key:
            splay: -5
            shift: [2.6, -1.6]
            column_net: col_4
        home:
          key:
            splay: -5
            shift: [3.9, -2.4]
            height: 1.5kx
            column_net: col_5
        inner:
          key: 
            splay: -5
            shift: [5.2, -3]
            height: 2.25kx
            column_net: col_6
      rows:
        cluster:
          row_net: row_5

outlines:
  keys:
    - what: rectangle
      where: true
      bound: false
      size: [14,14]
  outer:
    - what: polygon
      operation: stack
      points:
      - ref: matrix_outer_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_pinky_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_ring_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_middle_num
        shift: [-(kx/2+border_padding), ky/2+border_padding]
      - ref: matrix_middle_num
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: matrix_index_num
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: matrix_inner_num
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: matrix_inner_num
        shift: [30, ky/2+border_padding]
      - ref: matrix_inner_num
        shift: [30, -80]
      - ref: thumb_inner_cluster
        shift: [kx/2+border_padding, ky/2+border_padding]
      - ref: thumb_inner_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_home_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer-2_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer-3_cluster
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: thumb_outer-3_cluster
        shift: [-(kx/2+border_padding), -(ky/2+border_padding)]
      - ref: matrix_outer_bottom
        shift: [kx/2+border_padding, -(ky/2+border_padding)]
      - ref: matrix_outer_bottom
        shift: [-(kx/2+border_padding), -(ky/2+border_padding)]
      fillet: 5
  cutouts:
    - what: polygon
      operation: stack
      points:
        - ref: matrix_inner_num
          shift: [17, 4]
        - ref: matrix_inner_num
          shift: [24, 4]
        - ref: matrix_inner_num
          shift: [24, -1]
        - ref: matrix_inner_num
          shift: [17, -1]
      fillet: 0.5
    - what: polygon
      operation: stack
      points:
        - ref: matrix_inner_home
          shift: [10, 1]
        - ref: matrix_inner_home
          shift: [25, 1]
        - ref: matrix_inner_bottom
          shift: [25, -9.5]
        - ref: matrix_inner_bottom
          shift: [10, -4.5]
      fillet: 2.5
  combo:
    - name: outer
    - operation: subtract
      name: keys
  board:
    - name: outer
    - operation: subtract
      name: cutouts
    
pcbs:
  Palette58:
    outlines:
      main:
        outline: board
    footprints:
      gateron_low_profile_hotswap:
        what: gateron_low_profile
        where: true
        params:
          keycaps: true
          reverse: false
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
      diodes:
        what: combo_diode
        where: true
        adjust:
          shift: [8.25, 0]
          rotate: -90
        params:
          value: "1N4148"
          SMD: true
          from: "{{colrow}}"
          to: "{{row_net}}"
      per_key_rgb:
        what: XL-1615RGBC-WS2812B
        where: true
        adjust:
          shift: [0,5.75]
        params:
          din: ""
          dout: ""
      per_key_rgb_decoupling_capacitors:
        what: ceramic_capacitor
        where: true
        adjust:
          shift: [0, 8.25]
        params:
          value: "100nF"
          left: "GND"
          right: "VCC"
      hotswap_diode_vias:
        what: covered_via
        where: true
        adjust:
          shift: [6.40, -5.75]
        params:
          net: "{{colrow}}"
      led_ground_vias:
        what: covered_via
        where: true
        adjust:
          shift: [-0.7, 5.325]
        params:
          size: 0.65
          net: "GND"
      per-key-rgb_ground_vias:
        what: covered_via
        where: true
        adjust:
          shift: [-0.7, 8.25]
        params:
          net: "GND"
      nice!nano:
        what: nice!nano_v2
        params:
          orientation: "down"
          P031: "col_1"
          P029: "col_2"
          P002: "col_3"
          P115: "col_4"
          P113: "col_5"
          P111: "col_6"
          P017: "row_1"
          P020: "row_2"
          P022: "row_3"
          P024: "row_4"
          P100: "row_5"
          P104: "SCL"
          P106: "SDA"
          BPLUS: "B+"
          BMINUS: "GND"
        where:
          ref: matrix_inner_num
          shift: [20, -9]
          rotate: -90
      rgb_din_resistor:
        what: resistor
        where: matrix_inner_num
        adjust:
          shift: [7.5, 8.25]
          rotate: 0
        params:
          value: "330Ω"
          left: ""
          right: ""
      oled:
        what: oled
        adjust:
          ref: matrix_inner_num
          shift: [26, -25]
          rotate: -90
        params:
          SDA: "SDA"
          SCL: "SCL"
      jstph:
        what: jstph
        adjust:
          ref: matrix_inner_num
          shift: [12.5, -32]
          rotate: 90
        params:
          pos: "JST+"
          neg: "GND"
      power_switch:
        what: toggle_switch
        adjust:
          ref: matrix_inner_num
          shift: [28.5, -74]
          rotate: -90
        params:
          value: "MSK12C02-HB"
          from: "B+"
          right: "JST+"
          left: ""
      charging_diode:
        what: combo_diode
        adjust:
          ref: matrix_inner_num
          shift: [27.5, -32]
          rotate: 90
        params:
          value: "1N5819"
          SMD: true
          from: "B+"
          to: "JST+"
      reset_switch:
        what: push_switch
        where: matrix_inner_num
        adjust:
          shift: [18, -70]
          rotate: -20
        params:
          value: "TS-1187A-B-A-B"
          A: "RST"
          B: "GND"
      reset_pull_up_resistor:
        what: resistor
        where: matrix_inner_num
        adjust:
          shift: [11.5, -65]
          rotate: 90
        params:
          value: "10kΩ"
          left: "VCC"
          right: "RST"